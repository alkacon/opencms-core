<%@ page buffer="none" import="org.opencms.main.*, org.opencms.search.*, org.opencms.file.*, org.opencms.jsp.*, java.util.*" %><%   
    
    // Create a JSP action element
    CmsJspActionElement cms = new CmsJspActionElement(pageContext, request, response);
    
    // Get the search manager
    CmsSearchManager searchManager = OpenCms.getSearchManager(); 
%>

<html>

<script language=JavaScript>
<!--
top.head.helpUrl='administration/index.html';
//-->
</script>

<head>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">

<title>Rebuild search index</title>
<link rel=stylesheet type="text/css" href='<%=cms.link("/system/workplace/resources/format.css")%>'>

</head>
<body
    bgcolor="#ffffff"
    background='<%=cms.link("/system/workplace/resources/bg_weiss.gif")%>'
    bgproperties=fixed
    onLoad="window.top.body.admin_head.location.href='<%=cms.link("/system/workplace/action/administration_head.html")%>';">

<p>
	<h1>Search index overview</h1>
	
		
	<table border="1">
		<tr><th>Name</th><th>Rebuild Mode</th><th>Project</th><th>Locale</th></tr>
<%

	List indexNames = searchManager.getIndexNames();
	for (int i = 0, n = indexNames.size(); i < n; i++) {
		String indexName = (String)indexNames.get(i);
		CmsSearchIndex index = searchManager.getIndex(indexName);

%>
		<tr>
			<td><%=index.getName()%></td>
			<td><%=index.getRebuildMode()%></td>
			<td><%=index.getProject()%></td>
			<td><%=index.getLocale()%></td>
		</tr>
		<tr>
			<td>&nbsp;</td>
			<td colspan="4">
<%
	
		List sourceNames = index.getSourceNames();
		for (int j = 0, m = sourceNames.size(); j < m; j++) {
			String sourceName = (String)sourceNames.get(j);
			CmsSearchIndexSource indexSource = searchManager.getIndexSource(sourceName);
			
			List resourceNames = indexSource.getResourcesNames();
			for (int k = 0, l = resourceNames.size(); k < l; k++) {
				String resourceName = (String)resourceNames.get(k);
				out.println(resourceName);
				
				if (k < (l-1)) {
					out.println("<br>");
				}
			}
		}
	}
%>
			</td>
		</tr>
	</table>				
</p>

<p>
	<form method="post" action='<%=cms.link("/system/workplace/administration/searchindex/updateindex/rebuild.html")%>'>
    	<input type="submit" value="Rebuild All">
	</form>
</p>

</body>
</html>
